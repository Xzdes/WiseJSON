```markdown
docs/00-introduction-and-setup.md
# 00 - Введение и Начало Работы с WiseJSON DB

## Что такое WiseJSON DB и для чего она?

**WiseJSON DB** — это встраиваемая, файловая JSON-база данных для Node.js. Она разработана для высокой производительности, надежности и простоты интеграции в ваши приложения.

Используйте WiseJSON DB, когда вам нужно:

*   **Локальное хранилище данных**: Данные хранятся в файлах на диске, рядом с вашим приложением.
*   **Работа с JSON**: Нативно хранит и обрабатывает JavaScript-объекты (JSON).
*   **Быстрый доступ**: Оптимизирована для быстрых операций чтения и записи.
*   **Надежность**: Механизмы WAL (журнал упреждающей записи) с гарантированной синхронизацией каждой записи на диск по умолчанию и чекпоинтов защищают ваши данные от потерь при сбоях.
*   **Простота**: Не требует установки и настройки отдельного сервера базы данных.
*   **Функциональность**: Поддерживает индексы для быстрого поиска, TTL (время жизни) для автоматического удаления устаревших данных и ACID-транзакции для атомарных операций.

WiseJSON DB идеально подходит для:

*   Настольных приложений на Electron или NW.js.
*   Небольших и средних веб-сервисов, где не требуется сложная распределенная СУБД.
*   Кэширования данных.
*   Хранения конфигураций.
*   Прототипирования и быстрой разработки.

## Установка и Подключение

### Установка

Чтобы установить WiseJSON DB в ваш проект, используйте npm или yarn:

```bash
npm install wise-json-db
# или
yarn add wise-json-db
```

### Подключение в проекте

После установки вы можете подключить библиотеку в вашем Node.js коде:

```javascript
const WiseJSON = require('wise-json-db');
const path = require('path'); // Модуль path обычно полезен для указания путей к файлам БД
```

## Основной Порядок Работы (Базовый Workflow)

Работа с WiseJSON DB включает несколько основных шагов:

### Шаг 1: Инициализация Базы Данных

Прежде чем начать работу, необходимо создать экземпляр `WiseJSON` и инициализировать его. При создании экземпляра вы указываете путь к директории, где будут храниться файлы базы данных. Если директория не существует, WiseJSON DB попытается ее создать.

```javascript
const WiseJSON = require('wise-json-db');
const path = require('path');

async function initializeDatabase() {
  // Укажите путь к директории для вашей базы данных
  // Рекомендуется использовать абсолютный путь
  const dbPath = path.resolve(__dirname, 'myApplicationDatabase');

  // Создаем экземпляр WiseJSON
  const db = new WiseJSON(dbPath);

  try {
    // Инициализируем базу данных. Это асинхронная операция.
    await db.init();
    console.log(`База данных успешно инициализирована в директории: ${dbPath}`);
    return db; // Возвращаем экземпляр для дальнейшей работы
  } catch (error) {
    console.error('Ошибка при инициализации базы данных:', error);
    throw error; // Пробрасываем ошибку дальше, если инициализация не удалась
  }
}

// Пример использования:
// initializeDatabase().then(dbInstance => {
//   if (dbInstance) {
//     // Здесь можно начинать работать с dbInstance
//     // Не забудьте dbInstance.close() когда закончите
//   }
// });
```
**Важно:** `await db.init()` должен быть вызван и успешно завершен перед любыми другими операциями с базой данных.

### Шаг 2: Получение (или создание) Коллекции

Данные в WiseJSON DB хранятся в **коллекциях**. Коллекция — это аналог таблицы в реляционных базах данных или контейнер для JSON-документов.

Чтобы работать с коллекцией, ее нужно получить по имени. Если коллекция с указанным именем не существует, она будет создана автоматически.

```javascript
// (Продолжение предыдущего примера, предполагаем, что `db` - это успешно инициализированный экземпляр WiseJSON)

async function getAppCollection(db) {
  try {
    // Получаем (или создаем, если не существует) коллекцию с именем 'users'
    const usersCollection = await db.collection('users');

    // Каждая коллекция также проходит внутреннюю инициализацию
    // (загрузка данных из чекпоинтов и WAL).
    // Необходимо дождаться ее завершения.
    await usersCollection.initPromise;

    console.log('Коллекция "users" готова к работе.');
    return usersCollection; // Возвращаем коллекцию для операций с документами
  } catch (error) {
    console.error('Ошибка при получении коллекции:', error);
    throw error;
  }
}

// Пример использования:
// initializeDatabase()
//   .then(dbInstance => {
//     if (!dbInstance) return;
//     return getAppCollection(dbInstance).then(usersCol => ({ dbInstance, usersCol }));
//   })
//   .then(result => {
//     if (!result) return;
//     const { dbInstance, usersCol } = result;
//     // Здесь можно работать с usersCol
//     // Не забудьте dbInstance.close()
//   })
//   .catch(err => console.error("Общая ошибка:", err));
```
**Важно:** `await collection.initPromise` должен успешно разрешиться перед тем, как вы начнете выполнять операции чтения или записи для этой коллекции.

### Шаг 3: Работа с Данными в Коллекции

После получения экземпляра коллекции вы можете выполнять различные операции с документами:

*   Добавление новых документов ( `insert`, `insertMany`).
*   Чтение документов ( `getById`, `getAll`, `find`, `findOne`).
*   Обновление существующих документов ( `update`, `updateMany`).
*   Удаление документов ( `remove`, `removeMany`).
*   Использование индексов для ускорения поиска.
*   Использование транзакций для атомарных операций.

Подробно эти операции описаны в следующих разделах документации.

### Шаг 4: Закрытие Базы Данных

Когда ваше приложение завершает работу или больше не нуждается в доступе к базе данных, очень важно **правильно ее закрыть**. Это гарантирует, что все изменения, находящиеся в памяти или в WAL-файле, будут корректно сохранены на диск в виде чекпоинтов.

```javascript
// (Предполагаем, что `db` - это ваш экземпляр WiseJSON)

async function closeDatabase(db) {
  if (db && typeof db.close === 'function') {
    try {
      await db.close();
      console.log('База данных успешно закрыта. Все данные сохранены.');
    } catch (error) {
      console.error('Ошибка при закрытии базы данных:', error);
    }
  }
}

// Пример использования в конце работы вашего приложения:
// const myDbInstance = await initializeDatabase();
// ... работа с базой ...
// await closeDatabase(myDbInstance);
```
**Примечание:** WiseJSON DB пытается автоматически сохранить данные при штатном завершении процесса Node.js (например, по сигналам `SIGINT`, `SIGTERM`). Однако, для максимальной надежности всегда рекомендуется вызывать `await db.close()` явно.

### Полный Минимальный Пример

Вот полный пример, объединяющий все шаги:

```javascript
const WiseJSON = require('wise-json-db');
const path = require('path');

async function runMinimalExample() {
  const dbPath = path.resolve(__dirname, 'myApplicationDatabase');
  let db; // Объявляем db здесь, чтобы он был доступен в finally

  try {
    // Шаг 1: Инициализация базы данных
    db = new WiseJSON(dbPath);
    await db.init();
    console.log('База данных инициализирована.');

    // Шаг 2: Получение коллекции
    const notesCollection = await db.collection('notes');
    await notesCollection.initPromise;
    console.log('Коллекция "notes" готова.');

    // Шаг 3: Работа с данными (простой пример)
    const newNote = await notesCollection.insert({ title: 'Моя первая заметка', content: 'Привет, WiseJSON!' });
    console.log('Добавлена заметка:', newNote);

    const allNotes = await notesCollection.getAll();
    console.log(`Всего заметок: ${allNotes.length}`);

  } catch (error) {
    console.error('Произошла ошибка в примере:', error);
  } finally {
    // Шаг 4: Закрытие базы данных
    if (db) {
      await db.close();
      console.log('База данных закрыта.');
    }
  }
}

runMinimalExample();
```

Этот базовый рабочий процесс является основой для использования WiseJSON DB в ваших проектах. В следующих разделах мы подробно рассмотрим операции с документами, индексами, транзакциями и другие возможности.